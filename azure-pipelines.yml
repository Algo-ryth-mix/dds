# Refer: https://aka.ms/yaml

jobs:

  ## XXX: Windows on Azure cannot build until we have range-v3 supporting compiler
  ##      available on the system. Just disable for now.
  # - job: Windows_MSVC_VS2019
  #   pool:
  #     vmImage: windows-2019
  #   steps:
  #     - script: |
  #         echo Loading VS environment
  #         call "C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Enterprise\\Common7\\Tools\\vsdevcmd" -arch=x64 || exit 1
  #         echo Executing build/test script
  #         python -u tools/build.py --cxx cl.exe --test --static || exit 1
  #       displayName: Build and Run Unit Tests
  #     - publish: _build/ddslim.exe
  #       artifact: DDSLiM Executable - Windows VS2019
  #     - script: |
  #         echo Loading VS environment
  #         call "C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Enterprise\\Common7\\Tools\\vsdevcmd" -arch=x64 || exit 1
  #         python -u tools/test.py --exe _build/ddslim.exe -T:msvc || exit 1
  #       displayName: Smoke Tests

  - job: Linux_GCC8
    pool:
      vmImage: ubuntu-18.04
    steps:
      - script: sudo apt install -y python3-minimal g++-8
        displayName: Prepare System
      - script: python3 -u tools/build.py --cxx g++-8 --test --static
        displayName: Build and Run Unit Tests
      - publish: _build/ddslim
        artifact: DDSLiM Executable - Linux
      - script: python3 -u tools/test.py --exe _build/ddslim -T:gcc-8
        displayName: Smoke Tests

  - job: macOS_GCC8
    pool:
      vmImage: macOS-10.14
    steps:
      - script: brew install gcc@8
        displayName: Prepare System
      - script: python3 -u tools/build.py --cxx g++-8 --test
        displayName: Build and Run Unit Tests
      - publish: _build/ddslim
        artifact: DDSLiM Executable - macOS
      - script: python3 -u tools/test.py --exe _build/ddslim -T:gcc-8
        displayName: Smoke Tests
